<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title> Artificial Intelligence </title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/aistyle.css') }}">

</head>

<body>
  <h1 style="color:white; text-align: center;"> AI </h1>
  <span style="color:skyblue; text-align: center;"> Click the Button to Talk with AI </span>
  <div id="startButton" class="imageWrapper">
    <img id="btn" src="{{ url_for('static', filename='images/aiBtn.png') }}" alt="AI">
  </div>
  <center>
    <p id="result" style="color:darkblue"></p>
    <p id="response" style="color:darkblue; text-align: right;"></p>
  </center>

  <script>
    var recognition = new webkitSpeechRecognition() || new SpeechRecognition();
    recognition.continuous = true;
    recognition.lang = 'en-US';
    var BTNstart = document.getElementById('startButton');
    var btn = document.getElementById('btn');
    var TXTresult = document.getElementById('result');
    var TXTresponse = document.getElementById('response');
    var result = "";
    var flag = 0;

    recognition.onresult = function (event) {
      recognition.stop();
      result = event.results[0][0].transcript;
      result = result.toLowerCase();
      TXTresult.innerHTML = result;
      btn.className = "fade-out";
      btn.src = "{{ url_for('static', filename='images/aiBtn.png') }}";
      wordRecognition();
    };

    BTNstart.addEventListener('click', function () {
      if (flag == 0) {
        btn.className = "fade-in";
        btn.src = "{{ url_for('static', filename='images/ai.jpg') }}";
        TXTresult.innerHTML = "Listenning...";
        TXTresponse.innerHTML = "";
        recognition.start();
        flag = 1;
      }

      else {
        btn.className = "fade-out";
        btn.src = "{{ url_for('static', filename='images/aiBtn.png') }}";
        TXTresult.innerHTML = "";
        recognition.stop();
        TXTresponse.innerHTML = "";
        flag = 0;
      }
    });

    function getName(sentence) {
      const words = sentence.split(' ');
      const nameIndex = words.findIndex(word => word.toLowerCase() === 'name');
      if (nameIndex !== -1 && nameIndex < words.length - 1) {
        return words[nameIndex + 1];
      } else {
        return null;
      }
    }


    function getBudget(sentence) {
      const words = sentence.split(' ');

      const budgetIndex = words.findIndex(word => word.toLowerCase() === 'budget');

      if (budgetIndex !== -1) {
        if (budgetIndex < words.length - 1) {
          return words[budgetIndex + 1];
        } else if (budgetIndex > 0) {
          return words[budgetIndex - 1];
        }
      }
      return null;
    }

    function wordRecognition() {
      // console.log(result);
      // console.log("word recognition");
      var words = ["home", "features", "login", "register"];
      var found = false;

      for (word in words) {
        if (!found) {
          if (result.includes(words[word])) {
            var page = words[word];
            const speechText = new SpeechSynthesisUtterance("Okay, taking you to " + page + " page.");
            TXTresponse.innerHTML = "Okay, taking you to " + page + " page.";
            window.speechSynthesis.speak(speechText);
            setTimeout(function () {
              document.location.href = page;
            }, 2000);
            found = true;
          }

          else if (result.includes("back")) {
            const speechText = new SpeechSynthesisUtterance("Okay, taking you to " + page + " page.");
            window.speechSynthesis.speak(speechText);
            TXTresponse.innerHTML = "Okay, taking you to Previous page.";
            setTimeout(function () {
              window.history.go(-1);
            }, 200);
            found = true;
          }

          else if (result.includes("previous")) {
            const speechText = new SpeechSynthesisUtterance("Okay, taking you to Previous page.");
            window.speechSynthesis.speak(speechText);
            TXTresponse.innerHTML = "Okay, taking you to Previous page.";
            setTimeout(function () {
              window.history.go(-1);
            }, 200);
            found = true;
          }

          else if (result.includes("hi")) {
            const speechText = new SpeechSynthesisUtterance("Hello! How can I assist you today?");
            window.speechSynthesis.speak(speechText);
            TXTresponse.innerHTML = "Hello! How can I assist you today?";
            found = true;
          }

          else if (result.includes("hello")) {
            const speechText = new SpeechSynthesisUtterance("Hi! How can I assist you today?");
            window.speechSynthesis.speak(speechText);
            TXTresponse.innerHTML = "Hi! How can I assist you today?";
            found = true;
          }

          else if (result.includes("what is your name")) {
            const speechText = new SpeechSynthesisUtterance("I am Voice Finance Assistant");
            window.speechSynthesis.speak(speechText);
            TXTresponse.innerHTML = "I am Voice Finance Assistant";
            found = true;
          }

          else if (result.includes("budget name")) {
            const name = getName(result);
            // console.log("Name =" + name);

            const data = { name: name };
            const options = {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(data)
            };

            fetch('create', options)
              .then(response => {
                if (!response.ok) {
                  throw new Error('Failed to create data');
                }
                else {
                  alert("Budget Created Successfully.");
                  window.location.href = 'budget';
                  return response.json();
                }
              })
              .then(data => {
                console.log('Budget created successfully:', data);
              })
              .catch(error => {
                console.error('Error:', error);
              });

            const speechText = new SpeechSynthesisUtterance("Creating New Budget named " + name + "...");
            window.speechSynthesis.speak(speechText);
            TXTresponse.innerHTML = "Creating New Budget named " + name + "...";
            found = true;
          }

          else if (result.includes("budget")) {
            const budget = getBudget(result);
            // console.log("Name =" + budget);
            const data = { name: budget };
            const options = {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(data)
            };

            fetch('create', options)
              .then(response => {
                if (!response.ok) {
                  throw new Error('Failed to create data');
                }
                else {
                  alert("Budget Created Successfully.");
                  window.location.href = 'budget';
                  return response.json();
                }
              })
              .then(data => {
                console.log('Budget created successfully:', data);
              })
              .catch(error => {
                console.error('Error:', error);
              });

            const speechText = new SpeechSynthesisUtterance("Creating New Budget named " + budget + "...");
            window.speechSynthesis.speak(speechText);
            TXTresponse.innerHTML = "Creating New Budget named " + budget + "...";
            found = true;
          }

          else if (result.includes("who are you")) {
            const speechText = new SpeechSynthesisUtterance("I am Voice Finance Assistant");
            window.speechSynthesis.speak(speechText);
            TXTresponse.innerHTML = "I am Voice Finance Assistant";
            found = true;
          }
        }
      }

      if (!found) {
        const speechText = new SpeechSynthesisUtterance("Sorry, I didn't Understand.");
        window.speechSynthesis.speak(speechText);
        TXTresponse.innerHTML = "Sorry, I didn't Understand.";
      }
    }
  </script>
</body>

</html>